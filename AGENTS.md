# MER-DEN プロジェクト AGENTS

MerSearch Helper は、メルカリ検索結果に ♥ いいね数を表示して検索を手助けする Chrome 拡張機能です。新しく参加したメンバーは必ずこのドキュメントを確認し、ルールと共通認識をそろえてください。

---

## 変更解析とコミットメッセージ提案フロー

1. `git status` と `git diff --stat` で変更範囲を確認し、差分サマリーを把握します。
2. `npm run lint` → `npm run typecheck` → `npm run test` → `npm run build` の順で実行し、失敗がないことを確認します。
3. 変更内容を VS Code 拡張や社内スクリプト（例：`tools/commit-helper.mjs`）で自動要約し、コミットメッセージ候補を生成します。
4. メッセージ形式は `type(scope): 要約` を基本とし、本文に日本語で背景や補足を追記します。
5. 自動生成結果は必ず目視チェックし、必要があれば言い換え・追記してからコミットします。

---

## リファクタリング方針

- 外部の動作や出力を一切変えずに、内部構造のみを改善します。
- 大きな変更は避け、小さなステップでテストを挟みながら進めます。
- 可読性・保守性・型安全性の向上を目的とします。

### 遵守ルール

- 暗黙のフォールバック禁止
- 非合理なスイッチ引数・オプショナル引数禁止
- 環境変数・設定ファイルの追加禁止
- 将来の拡張を理由にした変更禁止（現時点の安定を優先）
- ユニットテストは原則変更禁止（やむを得ない場合は理由を明記）

---

## テスト・デバッグ方針

- テストカバレッジを定期的に確認し、100% を目指します（特にバックエンド相当部分）。
- デバッグは不具合修正を目的とし、リファクタリングとは区別します。
- 新機能・修正後は必ず既存テストをすべて通過させます。

---

## コメント・ドキュメント規約

- 初めて触れる人でも理解できるコメントを必ず残します。
- 省略語・略称を避け、意図と背景を明確に説明します。
- TypeScript では **TSDoc 形式** を使用します。
- レポートや出力は日本語でまとめます。

---

## 定期リファクタチェック項目

- 不要なコード・依存の削除
- 型安全性に問題がないかの確認
- 複雑なネスト・ロジックの簡潔化
- テストカバレッジの向上と維持

---

## 注意事項

- コマンドが無限ループしても自動で止まらないため、実行時間に常に注意します。
- 実装開始前に設計・調査を必ず行い、設計が固まるまで実装は着手しません。

---

## 現在の重点テーマ

- 既存コードのリファクタリングとテスト整備を最優先で進めます。
- SOLID 原則に基づいた設計へ段階的に移行します（クラスやモジュールごとの責務分離を徹底）。
- 進捗レビューでは「どの責務を分離したか」「どのテストを整備したか」を記録します。

---

## 日常フローと便利コマンド

- 主要コマンド：`npm run build` / `npm run test` / `npm run typecheck` / `npm run lint`
- Pull Request 前には上記コマンドをすべて成功させ、要約とコミットメッセージ案を更新します。
- 定期的に `git fetch --all` で最新情報を取得し、差分の取り込み漏れを防ぎます。

---

## 🧑‍🎓 初めて読む人向けのミニ解説

- **リファクタリング**は、部屋の配置を変えずに机の中を片付けるイメージ。見た目は同じでも中身がスッキリします。
- **テストカバレッジ**は、テストがコードの何割を見張っているかの点数。点数が高いほど安心です。
- **SOLID 原則**は、部活動の役割分担表のように、プログラムの部品ごとの仕事をハッキリさせて壊れにくくする考え方です。
